

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running on Alexandria &mdash; Alexandria  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running on Terra" href="terra.html" />
    <link rel="prev" title="The Alexandria Metadata Convention" href="metadata.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #344563" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/dark_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">The Alexandria Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">The Alexandria Metadata Convention</a></li>
</ul>
<p class="caption"><span class="caption-text">dropseq_cumulus workflow</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running on Alexandria</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#known-bugs">Known Bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sign-in">1. Sign in</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-new-study">2. Create a new study</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uploading-sequence-data-files">3. Uploading sequence data files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-uploading-your-input-csv-file">4. Creating and uploading your input CSV file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-and-launch-dropseq-cumulus-workflow">5. Configure and launch dropseq_cumulus workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advice-for-troubleshooting">6. Advice for troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#synchronizing-and-exploring-visualization-options">7. Synchronizing and exploring visualization options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="terra.html">Running on Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="dropseq_cumulus.html">Inputs/Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="dropseq_bundle.html">Custom Genome</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bcl2fastq.html">Bcl2Fastq Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_upload.html">Alternatives for uploading data</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Alexandria</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Running on Alexandria</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/alexandria.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-on-alexandria">
<h1>Running on Alexandria<a class="headerlink" href="#running-on-alexandria" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://singlecell.broadinstitute.org/single_cell?scpbr=the-alexandria-project">The Alexandria portal</a> is hosted on the Broad Institute’s Single Cell Portal (SCP), therefore running the workflow here is identical to running it on SCP.</p>
<p>The Alexandria workflow version of dropseq_cumulus is intended as a user-accessible means of analyzing and visualizing single-cell RNA-seq data. Therefore, only essential parameters are exposed.</p>
<p>Those who would like more options for running the workflow should <a class="reference internal" href="terra.html"><span class="doc">use the Terra version</span></a> of the workflow and then transfer/sync the outputs to your Alexandria workspace study bucket.</p>
<p>If you truly would like certain parameters to be exposed, please post an issue on our GitHub repo.</p>
<div class="section" id="known-bugs">
<h2>Known Bugs<a class="headerlink" href="#known-bugs" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>For the time being, an older version of the workflow, dropseq_scCloud v74, is currently hosted on Alexandria. This workflow will not allow you to use bcl2fastq and will not allow you to upload data from the root of the bucket. You can use the <a class="reference external" href="terra.html">Terra version of the workflow</a> if need be.</p>
</div>
<p>For any discovered bugs, please contact us with bug reports on our GitHub repo.</p>
</div>
<div class="section" id="sign-in">
<h2>1. Sign in<a class="headerlink" href="#sign-in" title="Permalink to this headline">¶</a></h2>
<p>Visit <a class="reference external" href="https://singlecell.broadinstitute.org/single_cell?scpbr=the-alexandria-project">Alexandria</a> and at the top-right click “Sign In”. Sign in using your broadinstitute.org email account and allow permissions.
<img alt="_images/sign_in.png" src="_images/sign_in.png" /></p>
</div>
<div class="section" id="create-a-new-study">
<h2>2. Create a new study<a class="headerlink" href="#create-a-new-study" title="Permalink to this headline">¶</a></h2>
<p>To create a new study, click Add a Study. <em>Alternatively</em>, to run the workflow on a pre-existing study, select “My Studies”, click the Upload/Edit Study button for your study of choice and proceed to <a class="reference external" href="alexandria.html#creating-and-uploading-your-alexandria-sheet">upload your sequence data files</a>.
<img alt="_images/add_study.png" src="_images/add_study.png" /></p>
<p>When you arrive at the New Study page, first enter the name that you and others will use to identify your study.</p>
<p>Then, use the FireCloud Billing Project dropdown menu to select a billing project other than Default Project in order to run workflows in your study. If you do not have a billing project associated with your account, first click the “create a billing project” hyperlink under the Billing Projects header, on the next page click New Billing Project, and then follow the instructions supplied by clicking the <a class="reference external" href="https://software.broadinstitute.org/firecloud/documentation/article?id=9762">“Instructions on creating Google billing accounts”</a> button. You must include a billing project to access pipelines.</p>
<p>Next, fill out other fields to your liking, including the “No Data Download Until?” box, the “Public” dropdown menu, the “Use an existing workspace?” dropdown menu, and the “Description” box.
<img alt="_images/new_study1.png" src="_images/new_study1.png" />.</p>
<p>To share your study with others, click the “Share Study” button for whomever you wish to share your study with and then enter in their respective emails and permissions.</p>
<p>Attach external resources or publications that will help viewers understand your study using the “Add an External Resource” button for however documents you wish to share.<br />When all fields are filled in to your satisfaction, click the “Create Study” at the bottom.
<img alt="_images/new_study2.png" src="_images/new_study2.png" /></p>
</div>
<div class="section" id="uploading-sequence-data-files">
<h2>3. Uploading sequence data files<a class="headerlink" href="#uploading-sequence-data-files" title="Permalink to this headline">¶</a></h2>
<p>When the study is created you will arrive at the Upload/Edit Study page. Since we are running the workflow and do not have any expression matrix, metadata, cluster, or coordinate label files yet (these will be produced by the workflow), click the “Sequence Data” tab.
<img alt="_images/sequence_data1.png" src="_images/sequence_data1.png" /></p>
<p>There are a few methods of uploading files to your workspace Google Bucket. Before proceeding, find your workspace bucket by visiting your workspace’s “Dashboard” tab. In the bottom-right corner of the dashboard, you will see your Google Bucket ID which you can copy by clicking the adjacent clipboard button. You can visit the bucket interface by clicking the “Open in Browser” hyperlink.</p>
<p>First upload your sequence data files. We highly recommend installing and using <code class="docutils literal notranslate"><span class="pre">gsutil</span></code>, a fast and powerful tool made by Google that quickly moves files to and from the cloud. Through your computer’s console, install the <code class="docutils literal notranslate"><span class="pre">gsutil</span></code> tool by following the <a class="reference external" href="https://cloud.google.com/storage/docs/gsutil_install">installation guide</a>. An example command that would transfer files from your computer to the workspace bucket would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gsutil</span> <span class="o">-</span><span class="n">m</span> <span class="n">cp</span> <span class="n">local</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="n">fastq</span><span class="o">.</span><span class="n">gz</span> <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">Bucket</span> <span class="n">ID</span><span class="p">]</span><span class="o">/</span><span class="n">destination</span><span class="o">/</span><span class="n">directory</span><span class="o">/</span>
</pre></div>
</div>
<p>For an entire folder of sequence data, copy it recursively through using the command as such:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gsutil</span> <span class="o">-</span><span class="n">m</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="n">local</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">sequencing_run_directory</span> <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="p">[</span><span class="n">Bucket</span> <span class="n">ID</span><span class="p">]</span><span class="o">/</span><span class="n">destination</span><span class="o">/</span><span class="n">sequencing_run_directory</span>
</pre></div>
</div>
<p>Any desination path that does not exist already will be created upon entering the command!</p>
<p>To see other methods of uploading data, see <a class="reference internal" href="data_upload.html"><span class="doc">here</span></a>.</p>
</div>
<div class="section" id="creating-and-uploading-your-input-csv-file">
<h2>4. Creating and uploading your input CSV file<a class="headerlink" href="#creating-and-uploading-your-input-csv-file" title="Permalink to this headline">¶</a></h2>
<p>To instruct the workflow, you must create a sample sheet, called the input CSV file, that contains sample names, paths to sequencing data on the workspace bucket, and any metadata you wish to include on Alexandria. Write your input CSV file in a text editor or a spreadsheet manipulation program such as Microsoft Excel and save your file as a comma-separated value (.csv) file. For FASTQs The input CSV file must have column headers and contains the following in whatever order:</p>
<ul class="simple">
<li><p><strong>(REQUIRED)</strong> the ‘Sample’ column, the sample/array names that must prefix the respective .fastq or .fastq.gz files. Any preexisting count matrices must be prefixed in the same way.</p></li>
<li><p><strong>(RECOMMENDED)</strong> both ‘R1_Path’ and ‘R2_Path’ columns, the paths to .fastq/.fastq.gz files on the bucket. Alternatively, see the section on <a class="reference external" href="dropseq_cumulus.html#understanding-the-dropseq-default-directory-parameter">understanding the dropseq_default_directory parameter</a></p></li>
<li><p>(OPTIONAL) Other metadata columns that will be appended to the alexandria_metadata.txt file generated after running Cumulus. Column headers <em>must match exacty</em> the names of attributes found in the <a class="reference internal" href="metadata.html"><span class="doc">Alexandria Metadata Convention</span></a>. Labels outside of this convention will be supported in the future.
<img alt="_images/csv.png" src="_images/csv.png" /></p></li>
</ul>
<p>For processing sequencing run directories containing BCL files, see <a class="reference external" href="dropseq_cumulus.html#formatting-your-alexandria-sheet-for-bcl2fastq">here</a>.</p>
<p>To verify that the paths you listed in the file are correct, you can navigate to your bucket using the instructions listed <a class="reference external" href="alexandria.html#uploading-sequence-data-files">above</a> and locate your sequence data files. Click on each file to view its URI (gsURL), which should resemble the format <code class="docutils literal notranslate"><span class="pre">gs://&lt;bucket</span> <span class="pre">ID&gt;/path/to/file.fastq.gz</span></code> in the case of <code class="docutils literal notranslate"><span class="pre">gzip</span></code>-compressed FASTQ files (regular FASTQ files are fine too). The locations you should enter in the path columns of your input CSV file should be all of the characters following the bucket ID and trailing slash, in this case <code class="docutils literal notranslate"><span class="pre">path/to/file.fastq.gz</span></code>.
<img alt="_images/bucket2.png" src="_images/bucket2.png" /></p>
<p>When you have finished creating your sequencing data, proceed to the “Miscellaneous” tab in Alexandria. Here is where you will upload your Alexandria Sheet (spreadsheet) that will instruct the workflow.
To upload the Alexandria Sheet, click the “Choose File” button and navigate to select your Alexandria Sheet. Then set the file type as “Other” and click “Save” under the “Actions” text.
<img alt="_images/miscellaneous.png" src="_images/miscellaneous.png" /></p>
</div>
<div class="section" id="configure-and-launch-dropseq-cumulus-workflow">
<h2>5. Configure and launch dropseq_cumulus workflow<a class="headerlink" href="#configure-and-launch-dropseq-cumulus-workflow" title="Permalink to this headline">¶</a></h2>
<p><strong>To ensure that your study recognizes all files, return to your “My Studies” page and hit the “Synchronize” button for your study.</strong></p>
<p>On the “My Studies” page, click the name of your study hyperlink. Next, visit the “Analysis” tab which contains your “Submission History” and the interface that allows you to “Submit a Workflow.”</p>
<p>By default you are on the “Select Workflow” tab. Use the dropdown menu to select the dropseq_cumulus workflow.
<img alt="_images/analysis.png" src="_images/analysis.png" /></p>
<p>Then, click on the “Configure Inputs &amp; Submit” tab. Read the table of parameters below and enter the fields for each parameter to your liking. <img alt="_images/configuration.png" src="_images/configuration.png" /></p>
<p>Once done, click the “Submit Workflow” button at the bottom to submit the dropseq_cumulus job. Your job is viewable up top underneath the “Submission History” header.
<img alt="_images/submission_history.png" src="_images/submission_history.png" /></p>
<p>Here you will eventually know if the job ran succesfully. Provided the job does not fail within 10 minutes, the job will take about a variable amount of time to complete depending on the tasks you are running and the amount of data you gave it. Drop-seq pipeline usually will take 20 to 45 hours to run while Cumulus should take an hour or less.</p>
</div>
<div class="section" id="advice-for-troubleshooting">
<h2>6. Advice for troubleshooting<a class="headerlink" href="#advice-for-troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>If the job fails it is recommended you navigate to and read the log file of the task that failed.<br />To do this, click the Link URL of the failed job.
<img alt="_images/troubleshooting.png" src="_images/troubleshooting.png" /></p>
<p>Navigate to the log file of the failed task, which in this case is setup_dropseq.
<img alt="_images/fail2.png" src="_images/fail2.png" /></p>
<p>Evaluate the error based on the message and decide whether you need to alter variables, move files in your bucket, or change and reupload your Alexandria Sheet.</p>
<p><strong>Make sure to synchronize your study before relaunching the job.</strong></p>
</div>
<div class="section" id="synchronizing-and-exploring-visualization-options">
<h2>7. Synchronizing and exploring visualization options<a class="headerlink" href="#synchronizing-and-exploring-visualization-options" title="Permalink to this headline">¶</a></h2>
<p>If you study ran through the Cumulus task successfully:
Synchronize your the outputs by clicking the “Sync” button in the “Analysis” tab.
<img alt="_images/sync_outputs.png" src="_images/sync_outputs.png" /></p>
<p>Visualize the study by clicking the “Explore” tab and then the “View Options” hyperlink to gain more options for analysis.
<img alt="_images/visualization.png" src="_images/visualization.png" /></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="terra.html" class="btn btn-neutral float-right" title="Running on Terra" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="metadata.html" class="btn btn-neutral float-left" title="The Alexandria Metadata Convention" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Shalek Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>