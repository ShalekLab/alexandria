

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Inputs/Outputs &mdash; Alexandria  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bcl2Fastq Dockerfile" href="bcl2fastq.html" />
    <link rel="prev" title="Running on Terra" href="terra.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #344563" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/dark_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">The Alexandria Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">The Alexandria Metadata Convention</a></li>
</ul>
<p class="caption"><span class="caption-text">dropseq_cumulus Workflow</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="alexandria.html">Running on Alexandria</a></li>
<li class="toctree-l1"><a class="reference internal" href="terra.html">Running on Terra</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Inputs/Outputs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-input-csv-file">The input_csv_file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#formatting-your-input-csv-file-for-fastq-files">Formatting your input_csv_file for FASTQ files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formatting-your-input-csv-file-for-bcl2fastq">Formatting your input_csv_file for bcl2fastq</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-dropseq-default-directory-parameter">Understanding the dropseq_default_directory parameter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inputs-of-the-dropseq-cumulus-workflow">Inputs of the dropseq_cumulus workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-usage">Advanced usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-inputs-exposed-on-terra">Optional inputs exposed on Terra</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#outputs-of-the-dropseq-cumulus-workflow">Outputs of the dropseq_cumulus workflow</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bcl2fastq.html">Bcl2Fastq Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_upload.html">Alternatives for uploading data</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Alexandria</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Inputs/Outputs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/dropseq_cumulus.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="inputs-outputs">
<h1>Inputs/Outputs<a class="headerlink" href="#inputs-outputs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-input-csv-file">
<h2>The input_csv_file<a class="headerlink" href="#the-input-csv-file" title="Permalink to this headline">¶</a></h2>
<p>To instruct the workflow, you must create a sample sheet, called the input CSV file, that contains sample names, paths to sequencing data on the workspace bucket, and any metadata you wish to include on Alexandria.</p>
<div class="section" id="formatting-your-input-csv-file-for-fastq-files">
<h3>Formatting your input_csv_file for FASTQ files<a class="headerlink" href="#formatting-your-input-csv-file-for-fastq-files" title="Permalink to this headline">¶</a></h3>
<p>For processing a sequencing directory full of BCL files, see the below section instead.</p>
<p>Write your input csv file in a text editor or a spreadsheet manipulation program such as Microsoft Excel and save your file as a comma-separated value (.csv) file. The input CSV file must have column headers and contains the following in whatever order:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p><strong>(REQUIRED)</strong> the ‘Sample’ column, the sample/array names that must prefix the respective .fastq or .fastq.gz files. Any preexisting count matrices must be prefixed in the same way.</p></li>
<li><p><strong>(RECOMMENDED)</strong> both ‘R1_Path’ and ‘R2_Path’ columns, the paths to .fastq/.fastq.gz files on the bucket. Alternatively, see the section on <a class="reference external" href="dropseq_cumulus.html#understanding-the-dropseq-default-directory-parameter">Understanding the dropseq_default_directory parameter</a>.</p></li>
<li><p>(OPTIONAL) Other metadata columns that will be appended to the alexandria_metadata.txt (tab-delimited) file generated after running Cumulus. Column headers <em>must match exactly</em> the names of attributes found in the <a class="reference external" href="metadata.html">Alexandria Metadata Convention</a>. Labels outside of this convention will be supported in the future.</p></li>
</ul>
</div>
<p><img alt="_images/csv.png" src="_images/csv.png" /></p>
<p>To verify that the paths you listed in the file are correct, you can navigate to your Google bucket and locate your sequence data files. Click on each file to view its URI (gsURL), which should resemble the format <code class="docutils literal notranslate"><span class="pre">gs://&lt;bucket</span> <span class="pre">ID&gt;/path/to/file.fastq.gz</span></code> in the case of <code class="docutils literal notranslate"><span class="pre">gzip</span></code>-compressed FASTQ files (regular FASTQ files are fine too). The locations you should enter in the path columns of your input CSV file can be the entire URI or all of the characters following the bucket ID and trailing slash, in this case <code class="docutils literal notranslate"><span class="pre">path/to/file.fastq.gz</span></code>.
<img alt="_images/bucket2.png" src="_images/bucket2.png" /></p>
</div>
<div class="section" id="formatting-your-input-csv-file-for-bcl2fastq">
<h3>Formatting your input_csv_file for bcl2fastq<a class="headerlink" href="#formatting-your-input-csv-file-for-bcl2fastq" title="Permalink to this headline">¶</a></h3>
<p>Due to legal requirements, the default Docker image for bcl2fastq workflow made by the Cumulus Team is privately available for use by Broad Institute affiliates. Affiliates must create a Docker account using their broadinstitute.org email address, download <a class="reference external" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>, and log in through typing <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">login</span></code> in their terminal. Only then can you launch the bcl2fastq workflow on Alexandria or Terra.</p>
<p>If you are not an affiliate, you can either <a class="reference internal" href="bcl2fastq.html"><span class="doc">create and reference your own Docker image</span></a> or you can download the Bcl2Fastq software <a class="reference external" href="https://support.illumina.com/downloads/bcl2fastq-conversion-software-v2-20.html">here</a> and run it locally on a computer with plenty of disk space. If you chose the latter, once you get your FASTQs you can see the above section for writing a csv to process them.</p>
<p>Write your input csv file in a text editor or a spreadsheet manipulation program such as Microsoft Excel and save your file as a comma-separated value (.csv) file. The input CSV file must have column headers and contains the following in whatever order:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p><strong>(REQUIRED)</strong> the ‘Sample’ column, the sample/array names that are found in each sequencing directory’s sample sheet. Any pre-existing count matrices must have the sample names prefix each .txt.gz file.</p></li>
<li><p><strong>(REQUIRED)</strong> ‘BCL_Path’ column, the paths to the sequencing run directories on the bucket. Ex: <code class="docutils literal notranslate"><span class="pre">path/to/191231_NB501935_0679_AHVY52BGXB/</span></code></p></li>
<li><p>(OPTIONAL) Other metadata columns that will be appended to the alexandria_metadata.txt file generated after running Cumulus. Column headers <em>must match exactly</em> the names of attributes found in the <a class="reference external" href="metadata.html">Alexandria Metadata Convention</a>. Labels outside of this convention will be supported in the future.</p></li>
</ul>
</div>
<p><img alt="_images/csv_bcl.png" src="_images/csv_bcl.png" /></p>
<p>To verify that the paths you listed in the file are correct, you must navigate to your Google bucket and locate your sequence data files. Click on each file to view its URI (gsURL), which should resemble the format <code class="docutils literal notranslate"><span class="pre">gs://&lt;bucket</span> <span class="pre">ID&gt;/path/to/sequencing_run_directory/</span></code> in the case of sequencing run directories. The locations you should enter in the path columns of your input CSV file should be all of the characters following the bucket ID and trailing slash, in this case <code class="docutils literal notranslate"><span class="pre">path/to/sequencing_run_directory</span></code>.
<img alt="_images/bucket_bcl.png" src="_images/bucket_bcl.png" /></p>
</div>
<div class="section" id="understanding-the-dropseq-default-directory-parameter">
<h3>Understanding the dropseq_default_directory parameter<a class="headerlink" href="#understanding-the-dropseq-default-directory-parameter" title="Permalink to this headline">¶</a></h3>
<p>The use of this variable is not essential and is only meant for quick and convenient CSV writing. If the snapshot you are using requires <code class="docutils literal notranslate"><span class="pre">dropseq_default_directory</span></code> and you do not wish to use it, just enter an empty string: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<p>Refer to the above spreadsheet example. There are four samples which each have two FASTQ reads. All FASTQ files are found in a folder located at the root of the bucket called mouse_fastqs. Since they are all located in the same directory, one could set mouse_fastqs as the <code class="docutils literal notranslate"><span class="pre">dropseq_default_directory</span></code> and no longer need to have R1_Path and R2_Path columns.
<img alt="_images/csv2.png" src="_images/csv2.png" /></p>
<p>If the user has R1_Path and R2_Path columns but leaves spreadsheet cells left blank, the pipeline will search in the <code class="docutils literal notranslate"><span class="pre">dropseq_default_directory</span></code> for the corresponding sample.
<img alt="_images/csv3.png" src="_images/csv3.png" /></p>
<p>Here the pipeline will search the <code class="docutils literal notranslate"><span class="pre">gs://[bucket</span> <span class="pre">ID]/mouse_fastqs</span></code> directory for any spreadsheet cells left blank; DMSO_R2.fastq.gz, LGD_R1.fastq.gz, LKS_CGP_R1.fastq.gz, and LKS_CGP_R2.fastq.gz. The specific pattern the pipeline searches for is <code class="docutils literal notranslate"><span class="pre">&lt;Sample</span> <span class="pre">Name&gt;*&lt;R1</span> <span class="pre">or</span> <span class="pre">R2&gt;*.fastq.gz</span></code>.</p>
</div>
</div>
<div class="section" id="inputs-of-the-dropseq-cumulus-workflow">
<h2>Inputs of the dropseq_cumulus workflow<a class="headerlink" href="#inputs-of-the-dropseq-cumulus-workflow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-usage">
<h3>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bucket</p></td>
<td><p>gsURL of the workspace bucket to which you have permissions, ex: <code class="docutils literal notranslate"><span class="pre">gs://fc-e0000000-0000-0000-0000-000000000000/</span></code>. This value is not exposed on Alexandria and is locked to the workspace bucket.</p></td>
</tr>
<tr class="row-odd"><td><p>input_csv_file</p></td>
<td><p>Sample sheet (comma-separated value file) uploaded in the miscellaneous tab of this study’s Upload/Edit Study Data page. <a class="reference external" href="dropseq_cumulus.html#the-input-csv-file">**Formatting must adhere to the criteria!**</a></p></td>
</tr>
<tr class="row-even"><td><p>reference</p></td>
<td><p>Genome for alignment. Supported options: <code class="docutils literal notranslate"><span class="pre">hg19</span></code>, <code class="docutils literal notranslate"><span class="pre">GRCh38</span></code>, <code class="docutils literal notranslate"><span class="pre">mm10</span></code>, <code class="docutils literal notranslate"><span class="pre">hg19_mm10</span></code>, or <code class="docutils literal notranslate"><span class="pre">mmul_8.0.1</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>run_dropseq</p></td>
<td><p>Yes: run <a class="reference external" href="https://cumulus-doc.readthedocs.io/en/latest/drop_seq.html">Drop-seq pipeline</a> (sequence alignment and QC). Sequencing data must be uploaded to the Google bucket associated with this study.</p></td>
</tr>
<tr class="row-even"><td><p>is_bcl</p></td>
<td><p>Yes: <a class="reference external" href="dropseq_cumulus.html#formatting-your-input-csv-file-for-bcl2fastq">bcl2fastq</a> will be run to convert all of your BCL directories to fastq.gz. No: all of your data is already of fastq.gz type.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="dropseq_cumulus.html#understanding-the-dropseq-default-directory-parameter">dropseq_default_directory</a></p></td>
<td><p>Sequence data directory name for sequence uploaded to the SCP study google bucket. Ex: Enter <code class="docutils literal notranslate"><span class="pre">data/mouse_fastqs</span></code> for folder mouse_fastqs located at <code class="docutils literal notranslate"><span class="pre">gs://study</span> <span class="pre">bucket</span> <span class="pre">ID/data/mouse_fastqs/</span></code> If not applicable, list paths in the <a class="reference external" href="dropseq_cumulus.html#the-input-csv-file">input_csv_file</a>.</p></td>
</tr>
<tr class="row-even"><td><p>dropseq_output_directory</p></td>
<td><p>Path to folder name for Drop-seq outputs (aligned data, count matrices, etc.). All folders in this path will be created if they do not exist. Ex: Entering <code class="docutils literal notranslate"><span class="pre">data/20190909/aligned</span> <span class="pre">stores</span></code> Drop-Seq outputs at <code class="docutils literal notranslate"><span class="pre">gs:///data/20190909/aligned/</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>run_cumulus</p></td>
<td><p>Yes: run <a class="reference external" href="https://cumulus-doc.readthedocs.io/en/latest/cumulus.html">Cumulus</a> (generate metadata, cluster files, coordinate files for data exploration in Alexandria). If <code class="docutils literal notranslate"><span class="pre">run_cumulus</span></code> Yes and <code class="docutils literal notranslate"><span class="pre">run_dropseq</span></code> No: each expression matrix must be located within its sample subdirectory in the SCP study google bucket’s <code class="docutils literal notranslate"><span class="pre">dropseq_output_directory</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>cumulus_output_directory</p></td>
<td><p>Path to folder name for cumulus outputs (expression matrix, metadata, cluster, and coordinate files). All folders in this path will be created if they do not exist. Ex: Entering <code class="docutils literal notranslate"><span class="pre">data/20190909/analysis</span></code> stores Drop-Seq output files at <code class="docutils literal notranslate"><span class="pre">gs://study</span> <span class="pre">bucket</span> <span class="pre">ID/data/20190909/analysis/</span></code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="advanced-usage">
<h3>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>preemptible, default = <code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>Number of attempts using a preemptible virtual machine before requesting a higher-cost, non-preemptible instance. <a class="reference external" href="https://cloud.google.com/preemptible-vms/">See Google Cloud documentation</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>zones, default = <code class="docutils literal notranslate"><span class="pre">us-east1-d</span> <span class="pre">us-west1-a</span> <span class="pre">us-west1-b</span></code></p></td>
<td><p>The ordered list of zone preferences for requesting a Google machine to run the pipeline. See <a class="reference external" href="https://cloud.google.com/compute/docs/regions-zones/">Google Cloud documentation page</a>.</p></td>
</tr>
<tr class="row-even"><td><p>cumulus_output_prefix, default = <code class="docutils literal notranslate"><span class="pre">sco</span></code></p></td>
<td><p>Optional prefix for cumulus files to distinguish them from files from a different job.</p></td>
</tr>
<tr class="row-odd"><td><p>alexandria_version, default = <code class="docutils literal notranslate"><span class="pre">0.1</span></code></p></td>
<td><p>Version of the <a class="reference external" href="https://hub.docker.com/r/shaleklab/alexandria/tags">shaleklab/alexandria</a> dockerfile to use.</p></td>
</tr>
<tr class="row-even"><td><p>dropseq_tools_version, default = <code class="docutils literal notranslate"><span class="pre">2.3.0</span></code></p></td>
<td><p>Version of the <a class="reference external" href="https://hub.docker.com/r/cumulusprod/dropseq/tags">cumulusprod/dropseq</a> dockerfile to use for the respective version of dropseq-tools.</p></td>
</tr>
<tr class="row-odd"><td><p>cumulus_version, default = <code class="docutils literal notranslate"><span class="pre">0.12.0</span></code></p></td>
<td><p>Version of the <a class="reference external" href="https://hub.docker.com/r/cumulusprod/cumulus/tags">cumulusprod/cumulus</a> dockerfile to use for the respective version of cumulus.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="optional-inputs-exposed-on-terra">
<h3>Optional inputs exposed on Terra<a class="headerlink" href="#optional-inputs-exposed-on-terra" title="Permalink to this headline">¶</a></h3>
<p>See the <a class="reference external" href="https://cumulus-doc.readthedocs.io/en/latest/drop_seq.html#inputs">Drop-seq Pipeline workflow documentation</a>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>dropEst does not account for strandedness and therefore its usage is not recommended.</p>
</div>
<p>See the <a class="reference external" href="https://cumulus-doc.readthedocs.io/en/latest/cumulus.html#aggregate-matrix">Cumulus workflow documentation</a>.</p>
<p>See <a class="reference external" href="https://support.illumina.com/content/dam/illumina-support/documents/documentation/software_documentation/bcl2fastq/bcl2fastq_letterbooklet_15038058brpmi.pdf">Illumina’s bcl2fastq manual</a>.</p>
</div>
</div>
<div class="section" id="outputs-of-the-dropseq-cumulus-workflow">
<h2>Outputs of the dropseq_cumulus workflow<a class="headerlink" href="#outputs-of-the-dropseq-cumulus-workflow" title="Permalink to this headline">¶</a></h2>
<p>When running the Drop-Seq pipeline and/or Cumulus through dropseq_cumulus, the workflow yields the same outputs as its component workflows. You can see those documentations in the section above.</p>
<p>Explicitly, dropseq_cumulus presents the Single-Cell Portal with the alexandria metadata file (alexandria_metadata.txt), the dense expression matrix (ends with .scp.expr.txt), and the two coordinate files (end with .scp.X_diffmap_pca.coords.txt and .scp.X_fitsne.coords.txt).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bcl2fastq.html" class="btn btn-neutral float-right" title="Bcl2Fastq Dockerfile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="terra.html" class="btn btn-neutral float-left" title="Running on Terra" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Shalek Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>